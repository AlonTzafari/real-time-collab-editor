(this["webpackJsonpreal-time-collab-editor"]=this["webpackJsonpreal-time-collab-editor"]||[]).push([[0],{64:function(t,e,n){},65:function(t,e,n){},66:function(t,e,n){},73:function(t,e,n){},75:function(t,e,n){},77:function(t,e,n){},78:function(t,e,n){},79:function(t,e,n){},80:function(t,e,n){},81:function(t,e,n){"use strict";n.r(e);var r=n(15),o=n.n(r),a=n(41),c=n.n(a),i=(n(64),n(65),n(16)),s=(n(66),n(6)),u=n(56),d=new s.d,l=new u.a("ws://localhost:1234","prosemirror",d,{}),m=d.getXmlFragment("prosemirror"),f=l.awareness.getLocalState();f&&f.user&&f.user.color&&f.user.name||l.awareness.setLocalStateField("user",{color:function(){var t=["#b61010","#0d0dbb","#096809","#9b9b08","#914091","#9c620b"];return t[Math.floor(t.length*Math.random())]}(),name:function(){var t=["Jhon","Roy","Raje","Olaf","Jake","Bolt"];return t[Math.floor(t.length*Math.random())]}()});var b=Object(r.createContext)({yProvider:l,yType:m});n(73);var v=n(8);var j=function(t){var e=t.user;return Object(v.jsx)("div",{className:"userAvatar",style:{borderColor:e.color},children:e.name})};var h=function(){var t=Object(r.useState)([]),e=Object(i.a)(t,2),n=e[0],o=e[1],a=Object(r.useContext)(b).yProvider;return Object(r.useEffect)((function(){var t=function(t){var e=Array.from(a.awareness.getStates()).map((function(t){var e=Object(i.a)(t,2),n=e[0],r=e[1];return Object.assign(r.user,{id:n})}));o(e)};return a.awareness.on("change",t),function(){return a.awareness.off("change",t)}}),[]),Object(v.jsx)("header",{className:"header",children:Array.from(n).map((function(t){return Object(v.jsx)("div",{className:"avaterItem",children:Object(v.jsx)(j,{user:t})},t.id)}))})},O=n(30),p=(n(75),n(76),n(77),n(86));n(78);var g=function(t){var e=t.onClose,n=Object(r.useRef)(null),o=Object(r.useContext)(b).yProvider;return Object(r.useEffect)((function(){var t;null===(t=n.current)||void 0===t||t.focus()}),[]),Object(a.createPortal)(Object(v.jsx)("div",{className:"commentEditorCover",children:Object(v.jsxs)("div",{className:"commentEditor",children:[Object(v.jsx)(j,{user:o.awareness.getLocalState().user}),Object(v.jsxs)("form",{onSubmit:function(t){var r;e((null===(r=n.current)||void 0===r?void 0:r.value)||""),t.preventDefault()},children:[Object(v.jsx)("input",{ref:n,type:"text"}),Object(v.jsx)("button",{type:"submit",children:"\u27a4"})]})]})}),document.body)};n(79);var y=function(t){var e=t.current,n=t.onSelect,o=Object(r.useState)(!1),a=Object(i.a)(o,2),c=a[0],s=a[1],u=function(t){n(t),s(!1)};return Object(v.jsxs)("div",{className:"markerTooltip",children:[Object(v.jsx)("div",{className:"color",style:{backgroundColor:e},onClick:function(){return s(!c)}}),c&&Object(v.jsxs)("div",{className:"pallet",children:[Object(v.jsx)("div",{className:"color",style:{backgroundColor:"yellow"},onClick:function(){return u("yellow")}}),Object(v.jsx)("div",{className:"color",style:{backgroundColor:"cyan"},onClick:function(){return u("cyan")}}),Object(v.jsx)("div",{className:"color",style:{backgroundColor:"lime"},onClick:function(){return u("lime")}}),Object(v.jsx)("div",{className:"color",style:{backgroundColor:"red"},onClick:function(){return u("red")}})]})]})};var C=function(t){var e=t.editorActions,n=(t.view,Object(r.useState)("#ffff00")),o=Object(i.a)(n,2),a=o[0],c=o[1],s=Object(r.useState)(!1),u=Object(i.a)(s,2),d=u[0],l=u[1],m=Object(r.useContext)(b).yProvider;return Object(v.jsxs)("div",{className:"menuBar",children:[Object(v.jsx)("button",{title:"Bold",style:{fontWeight:"bold"},className:"menuBtn",onClick:function(t){e.current.setMark("strong"),t.preventDefault()},children:"B"}),Object(v.jsx)("button",{title:"Italic",style:{fontStyle:"italic"},className:"menuBtn",onClick:function(t){e.current.setMark("em"),t.preventDefault()},children:"I"}),Object(v.jsx)("button",{title:"Paragraph",className:"menuBtn",onClick:function(t){e.current.setBlock("paragraph"),t.preventDefault()},children:"P"}),Object(v.jsx)("button",{title:"Header",className:"menuBtn",onClick:function(t){e.current.setBlock("heading"),t.preventDefault()},children:"H"}),Object(v.jsxs)("div",{className:"menuBtn",children:[Object(v.jsx)("button",{title:"Marker",className:"menuBtn noLine",onClick:function(t){e.current.setMark("highlight",{color:a}),t.preventDefault()},children:"\ud83d\udd8c"}),Object(v.jsx)(y,{current:a,onSelect:c})]}),Object(v.jsx)("button",{title:"Comment",className:"menuBtn",onClick:function(t){l(!0),t.preventDefault()},children:"\ud83d\udcac"}),d&&Object(v.jsx)(g,{onClose:function(t){var n=Object(p.a)(),r=m.awareness.getLocalState().user;e.current.comment(n,r,t),l(!1)}})]})},x=n(26),k=n(4),w=n(53),N=n(1),S=n(3),M=n(5),B=n(13),D=n(28),E=new k.e("comments");var P=function(){function t(e){Object(S.a)(this,t),this.map=void 0,this.decorations=x.b.empty,this.map=e}return Object(M.a)(t,[{key:"getCommentPos",value:function(t,e){for(var n=0;n<e.doc.nodeSize;n++){var r=e.doc.nodeAt(n);if(r&&"comment"===r.type.name&&r.attrs.id===t.data.id)return n}return-1}},{key:"findCommentNodes",value:function(t){var e=[];return function t(n){"comment"===n.type.name?e.push(n):n.content.forEach((function(e){return t(e)}))}(t.doc),e}},{key:"addComment",value:function(t,e){var n=B.b.getState(e),r=n.type,o=n.binding,a={from:Object(D.a)(t.from,r,null===o||void 0===o?void 0:o.mapping),to:Object(D.a)(t.to,r,null===o||void 0===o?void 0:o.mapping),data:Object(O.a)({},t.data)},c=a.data.id;this.map.set(c,a)}},{key:"deleteComment",value:function(t){this.map.delete(t)}},{key:"createDecorations",value:function(t){var e=this,n=B.b.getState(t),r=n.doc,o=n.type,a=n.binding;if(!a)return this.decorations;var c=this.findCommentNodes(t),i=[];return c.forEach((function(t){var n=JSON.parse(t.attrs["data-comment"]),c=e.map.get(n.data.id);if(c){var s=Object(D.b)(r,o,c.from,null===a||void 0===a?void 0:a.mapping),u=Object(D.b)(r,o,c.to,null===a||void 0===a?void 0:a.mapping);if(s&&u){n.from=s,n.to=u;var d=function(t){var e=t.from,n=t.to,r=t.data.user.color+"80";return x.a.inline(e,n,{style:"background-color: ".concat(r)})}(n);i.push(d)}}})),this.decorations=x.b.create(t.doc,i),this.decorations}},{key:"apply",value:function(t,e){var n=t.getMeta(E),r=n&&n.type;return n&&r&&("newComment"===r?this.addComment(n.comment,e):"deleteComment"===r&&this.deleteComment(n.id)),this}}],[{key:"init",value:function(e){return new t(e)}}]),t}();n(80);var A=function(t){var e=t.parent,n=t.comment,o=t.close,a=Object(r.useState)(d()),c=Object(i.a)(a,2),s=c[0],u=c[1];return Object(r.useEffect)((function(){u(d());var t=function(t){u(d())};return window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[]),Object(v.jsxs)("div",{style:s,className:"commentCard",children:[Object(v.jsx)(j,{user:n.data.user}),Object(v.jsx)("button",{onClick:function(){return o()},children:"\u2716"}),Object(v.jsx)("div",{className:"content",children:n.data.text})]});function d(){try{return{top:e.getBoundingClientRect().top,right:document.querySelector(".editor").getBoundingClientRect().right-990}}catch(t){return s||{top:0,right:0}}}},L=function(){function t(e,n,r,o,a){Object(S.a)(this,t),this.node=void 0,this.dom=void 0,this.contentDOM=void 0,this.view=void 0,this.portal=void 0,this.addComment=void 0,this.removeComment=void 0,this.getPos=void 0,this.node=e,this.view=n,this.addComment=o,this.removeComment=a,this.getPos=r}return Object(M.a)(t,[{key:"init",value:function(){var t=this,e=JSON.parse(this.node.attrs["data-comment"]);this.dom=document.createElement("comment"),this.dom.classList.add("comment-ref"),this.dom.setAttribute("data-comment",this.node.attrs["data-comment"]);var n=document.createElement("div");n.classList.add("comment-anchor"),n.id=e.data.id,document.body.appendChild(n);var r=Object(a.createPortal)(Object(v.jsx)(A,{parent:this.dom,comment:e,close:function(){var n=t.getPos(),r=t.view.state.tr.delete(n,n+1).setMeta(E,{type:"deleteComment",id:e.data.id});t.view.dispatch(r)}.bind(this)}),n,e.data.id);return this.portal=r,this.addComment(r),this}},{key:"destroy",value:function(){var t,e,n=JSON.parse(this.node.attrs["data-comment"]),r='[id="'.concat(n.data.id,'"]');null===(t=document.querySelector(r))||void 0===t||t.remove(),(null===(e=this.portal)||void 0===e?void 0:e.key)&&this.removeComment(this.portal.key);var o=this.view.state.tr.setMeta(E,{type:"deleteComment",id:n.data.id});this.view.dispatch(o)}}]),t}(),F=function(t,e,n){var r=t.getMap("prosemirror-comments");return new k.d({key:E,state:{init:function(){return P.init(r)},apply:function(t,e,n){return e.apply(t,n)}},props:{nodeViews:{comment:function(t,r,o){return new L(t,r,o,e,n).init()}},decorations:function(t){return this.getState(t).createDecorations(t)}}})},J={group:"inline",inline:!0,atom:!0,selectable:!1,content:"",attrs:{"data-comment":{default:""}},toDOM:function(t){return["span",{class:"comment-ref","data-comment":t.attrs["data-comment"]}]},parseDOM:[{tag:"span.comment-ref",getAttrs:function(t){return{"data-comment":t.getAttribute("data-comment")}}}]};var R={group:"inline",content:"inline* text*",inline:!0,selectable:!0,attrs:{color:{default:"#ff0000"}},toDOM:function(t,e){var n=document.createElement("span");return n.classList.add("highlight"),n.id=t.attrs.id,n.style.backgroundColor=t.attrs.color,n},parseDOM:[{tag:"span.highlight"}]},I=w.a.spec.nodes,z=w.a.spec.marks,T=I.append({comment:J}),q=z.append({highlight:R}),H=new N.h({nodes:T,marks:q}),V=n(54),W=n(49),X=n(48),G=n(84),K=n(85),Q=function(t,e,n){var r=k.b.create({schema:H,plugins:[Object(X.c)(m),Object(G.a)(l.awareness),Object(K.c)(),Object(V.a)({"mod-z":K.b,"mod-y":K.a}),Object(V.a)(W.a),F(d,e,n)]}),o=new x.c(t,{state:r});o.focus();var a={setMark:function(t,e){o.focus(),Object(W.c)(H.marks[t],e)(o.state,o.dispatch)},setBlock:function(t,e){o.focus(),Object(W.b)(H.nodes[t],e)(o.state,o.dispatch)},comment:function(t,e,n){o.focus(),function(t,e,n){return function(r){var o=r.state.selection,a=o.from,c=o.to;if(c<=a||!a||!c)return!1;var i={from:a,to:c,data:{id:t,user:e,text:n}},s=r.state.tr.insert(a,r.state.schema.node("comment",{"data-comment":JSON.stringify(i)}));r.dispatch(s);var u=r.state.tr.setMeta(E,{type:"newComment",comment:i});r.dispatch(u)}}(t,e,n)(o)}};return{view:o,editorActions:a}};var U=function(){var t=Object(r.useRef)(),e=Object(r.useRef)(),n=Object(r.useRef)({}),o=Object(r.useState)({}),a=Object(i.a)(o,2),c=a[0],s=a[1],u=function(t){c[t.key]=t,s(Object(O.a)({},c))},d=function(t){delete c[t],s(Object(O.a)({},c))};return Object(r.useEffect)((function(){var r=Q(t.current,u,d),o=r.view,a=r.editorActions;return e.current=o,n.current=a,function(){return o.destroy()}}),[]),Object(r.useEffect)((function(){}),[c]),Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(C,{editorActions:n,view:e}),Object(v.jsx)("div",{className:"editor",ref:t}),Object.values(c)]})};var Y=function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(U,{})})};function Z(){return Object(v.jsxs)("div",{className:"App",children:[Object(v.jsx)(h,{}),Object(v.jsx)(Y,{})]})}var $=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,87)).then((function(e){var n=e.getCLS,r=e.getFID,o=e.getFCP,a=e.getLCP,c=e.getTTFB;n(t),r(t),o(t),a(t),c(t)}))};c.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(Z,{})}),document.getElementById("root")),$()}},[[81,1,2]]]);
//# sourceMappingURL=main.5cd141d7.chunk.js.map